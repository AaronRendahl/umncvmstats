---
title: "Formatting Output"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Formatting Output}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
#| include: false
library(tibble)
library(gt)
library(umncvmstats)
```

```{r}
a <- combine_tests(
  one_proportion_inference(34, 99),
  one_proportion_inference(25, 99),
  one_proportion_inference(10, 99),
  two_proportion_inference(c(25, 34), c(99,99)),
  two_proportion_inference(c(10, 34), c(99,99)))
```

## Rounding

It's trickier than I think it should be to get R to output a reasonable number of digits.
This package makes a guess that should be reasonable in most, but not all, cases.

To modify the number of digits that are output, use the `set_digits` function. You can either specify the number of significant digits or the number of decimal places. By default, digits for the estimate, the SE, and the confidence bounds are set for all rows.

```{r}
a |> set_digits(digits=2)
a |> set_digits(decimals=2)
```

Specific values can be specified using the column names and row numbers.
```{r}
a |> set_digits(decimals=5, columns="proportion", rows=1:2)
```

You can also set the number of decimals based on significant digits for a given column or columns; for example, when created, the decimals are set based on the number of significant digits needed for the SE and ME columns, where ME (the margin of error) is calculated from conf.high and conf.low.
```{r}
a |> set_digits(digits=2, by=c("SE", "ME"))
```

### Rounding p-values
Rounding p-values are currently handled within the `gt` mechanism, as described below.


## Formatting

All output from statistical tests in this package are stored as a special object (an `atest`) that knows how to print itself in a nice way.

```{r}
a
```

It does this by converting it into a `gt` object from the [gt](https://gt.rstudio.com/) package.

You can use any `gt` function by first doing this conversion yourself using `as_gt`. If you use any `gt` functions you'll need to load the `gt` library before `umncvmstats`.

The following table looks the same because I haven't added any other functions yet.

```{r}
a |> as_gt()
```

There are also a few useful functions in this package, as follows.

### Formatting p-values

The `fmt_pvalue` function formats p-values (anything named `p.value` or `p.adjust`), with `digits` significant digits, up to `max.digits` decimals. The default is 2 significant digits, and 4 maximum digits.
```{r}
a |> as_gt() |> fmt_pvalue(digits=3, max.digits=5)
```

### Compacting Tables

This compact table uses `font.size = 13` and `padding = 1`.
```{r}
a |> as_gt() |> tab_compact()
```

```{r}
a |> as_gt() |> tab_compact(font.size = 11, padding = 3)
```

## Output as text

To not use the `gt` style output, `print` with `as_gt=FALSE`.

```{r}
a |> print(as_gt=FALSE)
```

## Output as data set

To get the underlying output as a data set, use `as_tibble`. You'll need to have loaded the `tibble` library, which loads as part of the `tidyverse`. There are several options for how to handle the footnotes.

This is useful when further processing or graphics based on output is desired.

```{r}
a |> as_tibble()
```
